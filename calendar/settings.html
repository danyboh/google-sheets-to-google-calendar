 
<style>
    #loader {
        font-size: 14px;
        margin: 10px;
    }
    #form {
        display: none;
    }
</style>
<div id="loader">üîÑ Loading settings...</div>

<div id="form">
  <label>–õ—ñ—Ç–µ—Ä–∞ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –Ω–∞–∑–≤–∏ —ñ–≤–µ–Ω—Ç—É (–ù–∞–ø—Ä–∏–∫–ª–∞–¥: A)</label> <br/>
  <input type="text" id="eventNameCol" /> <br/>
  <label>–õ—ñ—Ç–µ—Ä–∞ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —ñ–≤–µ–Ω—Ç—É </label> <br/>
  <input type="text" id="eventDetailsCol" /> <br/>
  <label>–õ—ñ—Ç–µ—Ä–∞ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –¥–∞—Ç–∏ —ñ–≤–µ–Ω—Ç—É </label> <br/>
  <input type="text" id="eventDateCol" /> <br/>
  <label>–õ—ñ—Ç–µ—Ä–∞ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ —ñ–≤–µ–Ω—Ç—É </label> <br/>
  <input type="text" id="eventIdCol" /> <br/>
  <label>–õ—ñ—Ç–µ—Ä–∞ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å—É </label> <br/>
  <input type="text" id="checkboxCol" /> <br/>
  <label>–ê–π–¥—ñ –∫–∞–ª–µ–Ω–¥–∞—Ä—è </label> <br/>
  <input type="text" id="calendarId" /> <br/>
  <button onclick="save()">Save</button> <br/>
</div>

<script defer>

google.script.run
    .withSuccessHandler(config => {
        toggleLoading(false);
        if(!config) return;
        if (config.eventNameCol) {
            document.getElementById('eventNameCol').value = config.eventNameCol;
        }
        if (config.eventDetailsCol) {
            document.getElementById('eventDetailsCol').value = config.eventDetailsCol;
        }
        if (config.eventDateCol) {
            document.getElementById('eventDateCol').value = config.eventDateCol;
        }
        if (config.eventIdCol) {
            document.getElementById('eventIdCol').value = config.eventIdCol;
        }
        if (config.calendarId) {
            document.getElementById('calendarId').value = config.calendarId;
        }
        if (config.checkboxCol) {
            document.getElementById('checkboxCol').value = config.checkboxCol;
        }

    })
    .withFailureHandler(err => {
        document.getElementById('loader').innerText = '‚ö†Ô∏è Failed to load settings.';
        console.error(err);
        })
    .getSettings();

function save() {
    toggleLoading(true);
  const eventNameCol = document.getElementById('eventNameCol').value;
  const eventDetailsCol = document.getElementById('eventDetailsCol').value;
  const eventDateCol = document.getElementById('eventDateCol').value;
  const eventIdCol = document.getElementById('eventIdCol').value;
  const calendarId = document.getElementById('calendarId').value;
  const checkboxCol = document.getElementById('checkboxCol').value;

  let isInvalid = false;
  let colInvalidLabel = '';
  
  [{colValue: eventNameCol, colLabel: '–ö–æ–ª–æ–Ω–∫–∏ –Ω–∞–∑–≤–∏ —ñ–≤–µ–Ω—Ç—É'},  
  {colValue: eventDetailsCol, colLabel: '–ö–æ–ª–æ–Ω–∫–∏ –¥–µ—Ç–∞–ª–µ–π'},  
  {colValue: eventDateCol, colLabel: '–ö–æ–ª–æ–Ω–∫–∏ –¥–∞—Ç–∏'},  
  {colValue: eventIdCol, colLabel: '–ö–æ–ª–æ–Ω–∫–∏ –∞–π–¥—ñ'},
  {colValue: checkboxCol, colLabel: '–ö–æ–ª–æ–Ω–∫–∏ —á–µ–∫–±–æ–∫—Å—É'},
].forEach(({colValue, colLabel}) => {
    const isValid = isSingleLetter(colValue);
    if(!isValid) {
        isInvalid = true;
        colInvalidLabel = colLabel;
    }
  });

  if(isInvalid) {
    google.script.run
    .showError(`–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≤–µ–¥–µ–Ω–∞ –ª—ñ—Ç–µ—Ä–∞ ${colInvalidLabel} , –ø—Ä–∏–∫–ª–∞–¥: J`);
    toggleLoading(false);
    return;
  }

  if(!calendarId) {
    google.script.run
    .showError('–í–≤–µ–¥—ñ—Ç—å –∞–π–¥—ñ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó');
    toggleLoading(false);
    return;
  }

  google.script.run
    .withSuccessHandler(() => {
        google.script.run
        .showSuccess('–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∞');
        google.script.host.close();

    })
    .withFailureHandler(err => {
        toggleLoading(false);
         google.script.run
        .showError('–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó: ' + err.message);
      })
    .saveSettings({ 
        eventNameCol,
        eventDetailsCol,
        eventDateCol,
        eventIdCol,
        calendarId,
        checkboxCol
     });
}

function isSingleLetter(str) {
  return /^[A-Za-z]$/.test(str);
}

function toggleLoading(value) {
    if(value) {
        document.getElementById('loader').style.display = 'block';
        document.getElementById('form').style.display = 'none';
    } else {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('form').style.display = 'block';
    }

}
</script>
